!function(e){"use strict";function t(){var e=location.hash.replace(/^#\/?/,"").split("/").map(function(e){var t=e.split("?"),n=(t[1]||"").split("&"),o=t[0],r={};return r[o]={},n.forEach(function(e){var t=e.split("="),n=t[0],c=decodeURIComponent(t[1]);r[o][n]=c}),r});e.path=e.map(function(e){return Object.keys(e)[0]}).join("/"),e.params={},e.forEach(function(t){var n=t[Object.keys(t)[0]];Object.keys(n).forEach(function(t){e.params[t]=n[t]})}),console.log("state:",e),V.forEach(function(t){t(e)}),window.setTimeout(function(){p()},100),P=e}function n(e,t){return t&&t>A?void console.log("Max nesting level is: "+A):(t++,void Object.keys(I).forEach(function(n){s(I,n,null,null,null,e,t)}))}function o(e){Object.keys(M).forEach(function(t){for(var n=e||document,o=n.querySelectorAll(t),r=0;r<o.length;r++){var c=M[t];o[r].xcssHandler||(console.log("binding message events: "+c.hash+" to "+t),"prevent"===c.hash?o[r].xcssHandler=function(e){e.preventDefault(),e.stopPropagation()}:o[r].xcssHandler=S(c.hash),o[r].addEventListener(c.event,o[r].xcssHandler))}})}function r(e){Object.keys(N).forEach(function(t){var n=e||document,o=n.querySelectorAll(t)||[],r=N[t]||[];[].slice.call(o).forEach(function(e){r.forEach(function(n){console.log("applying "+n+" to "+t),e.classList.add(n)})})})}function c(){window.setTimeout(i,100)}function i(){console.time("processCSSRules"),C(document),l(R),console.timeEnd("processCSSRules"),t()}function l(e){Object.keys(e).forEach(function(t){var n,o,r,c="",i="",l=[],a={},u=t.split('"').map(function(e,t){return t%2===1?(a["$"+t]=e,"$"+t):e}).join('"'),f=u.split(X);if(!k[t])if(k[t]=e[t],console.log("parts: ["+f.join(" : "),"] selector:",t),n="",f.length>2){if(i=f.shift().trim().replace(/"\$(\d+)"/g,'"'+a.$1+'"'),c=f.shift().trim(),o=c.toUpperCase(),r=c.toLowerCase(),l=f.filter(function(e){var t=D[e.toUpperCase()];return n=t&&T!==t?c:n,!t}).map(function(e){return e.replace(/"\$\d+"/g,function(e){return'"'+a[e.replace(/"/g,"")]+'"'})}),n)return void console.error('cannot proces invalid xcss rule: "'+t+'" unexpected keyword "'+n+'"');D[o]?D[o](e,t,i,l,c):F.indexOf(o)>=0&&w(e,t,i,l,r)}else e[t].style.content&&s(e,t,i,l,c)})}function s(t,n,o,r,c,i,l){var s,a,u=t[n].style.content||"",f=document.querySelectorAll(n);i&&(f=i.querySelectorAll(n)),/:(before|after)/.test(n)||(I[n]||(I[n]={style:{content:R[n].style.content}}),console.log("inserting content for: "+n),(a=u.match(/^url\(([^)]*)\)$/))&&(s=a[1],(a=s.match(/^"(.*)"$/))&&(s=s.slice(1,-1)),(a=u.match(/^"(.*)"$/))&&(u=u.slice(1,-1)),R[n].style.content=""),[].slice.call(f).forEach(function(t){if(t.insertedContent!==u)if(t.insertedContent=u,s)O(e(s),t,l);else try{var n=e(u.slice(1,-1));j(t,n,l)}catch(o){console.error("Could not evaluate expression: "+u)}}))}function a(e,t){var n=document.querySelectorAll(e);[].slice.call(n).forEach(function(e){e.style.boxSizing="border-box";var t=parseInt(e.style.marginLeft||"0"),n=e.parentNode.offsetWidth+e.parentNode.offsetLeft-(e.offsetLeft+e.offsetWidth);e.style.marginLeft=t+n+"px",e.style.marginRight="0px",e.style.marginTop="-70px"})}function u(t,n){console.log("sizeElements"),n&&n.forEach(function(n){var o=n.style,r=o.cssText.split("; ").filter(function(e){return e.trim().indexOf("content:")<0}).join(";\n"),c=o.content,i=document.querySelectorAll(t);[].slice.call(i).forEach(function(t){var o=n.selectorText.toUpperCase().indexOf(" SIZE "),i=n.selectorText.substring(o+6),l=!1,s=i.match(/(widthFor|heightFor)\[([^=]*)="(.*)"\]/);if(s){var a=s[3],u=document.createElement("div");u.style.cssText="position='absolute';width:auto;height:auto;white-space: nowrap;display:inline-block",u.innerHTML=a,t.appendChild(u),t.width=t.offsetWidth,t.height=t.offsetHeight,t.widthFor={},t.heightFor={},t.widthFor[a]=u.offsetWidth,t.heightFor[a]=u.offsetHeight,t.removeChild(u)}try{l=e(i,t)}catch(f){console.error("invalid SIZE condition! "+i+", error: "+f)}if(l&&(console.log("SIZE condition: "+i),t.style.cssText=r.replace(/\$\{[^\}]*\}/g,function(t){var n=t.substring(2,t.length-1);return e(n)}),c)){var p=""+e(c.slice(1,-1));j(t,p)}})})}function f(e,t,n,o,r){q[n]=o,a(n,o[0]),p()}function p(){Object.keys(q).forEach(function(e){window.setTimeout(function(){a(e,q[e])},100)})}function h(e,t,n,o,r){U[n]||(U[n]=[]),U[n].push(e[t]),d()}function d(){Object.keys(U).forEach(function(e){window.setTimeout(function(){u(e,U[e])},100)})}function g(e,t,n,o,r){U[n]||(U[n]=[]),W[n].push(e[t]),v(o)}function v(){Object.keys(W).forEach(function(e){window.setTimeout(function(){m(e,U[e])},parsetInt(sources[0]))})}function m(e,t){console.log("timer event for : "+e)}function y(e,t,n,o,r){var c,i=Object.create(HTMLElement.prototype),l={},s=/\[template(Id|Url)="([\w-\/\.]*)"\]/i,a=o[0].match(s);a?(l.template={},a.shift(),c=a.shift().toLowerCase(),l.template[c]=a.shift()):l.content=e[t].style.content.replace(/^"/,"").replace(/"$/,""),J[n.toUpperCase()]=l,i.createdCallback=function(){var e=this.createShadowRoot(),t=J[this.tagName];if(t.template)if(t.template.id){var n=document.querySelector("#"+t.template.id),o=document.importNode(n.content,!0);e.appendChild(o)}else t.template.url&&fetch(t.template.url).then(function(e){return e.text()}).then(function(t){e.innerHTML=t});else e.innerHTML=t.content},document.registerElement&&document.registerElement(n,{prototype:i});var u=e[t];G.insertRule(n+"{"+u.style.cssText+"}",G.cssRules.length)}function x(e,t,n,o,r){var c=o.map(function(t){return e[t]||(console.log("resolving rule fromSelector: "+t),l(e)),e[t]?console.debug("Resolved rule fromSelector: "+t+" = "+e[t].style.cssText):console.error("Could not resolve rule fromSelector: "+t),e[t]?e[t].style.cssText:""}).join(" "),i=e[t];console.log("adding rule: "+n+"{"+c+i.style.cssText+"}");var a=G.insertRule(n+"{"+c+i.style.cssText+"}",G.cssRules.length);if(e[n]=G.cssRules[a],e[n].style.content){var u=0;s(e,n,n,o,r,document,u)}}function E(e,t,n,o,r){var c=document.querySelectorAll(n);N[n]=o,[].slice.call(c).forEach(function(e){o.forEach(function(t){var o;if(o=t.match(/^\[(.*)\]$/)){var r=o[1].split("=");console.log("applying attr: "+o[1]+" to "+n),e.setAttribute(r[0],r[1]||r[0])}else console.log("applying class: "+t+" to "+n),e.classList.add(t)})})}function b(e,t,n,o,r){console.log("binding message WHEN listener: "+o+" to "+t),console.log("binding message listener: "+o),V.push(L(n,o,t,e))}function w(e,t,n,o,r){var c=o[0]||r;console.log("binding message events: "+c+" to "+n+" for "+r),M[n]={hash:c,event:r.substring(2)};var i=document.querySelectorAll(n);[].slice.call(i).forEach(function(e){console.log("adding eventlistener for "+c),"prevent"===c?e.xcssHandler=function(e){e.preventDefault(),e.stopPropagation()}:e.xcssHandler=S(c),e.addEventListener(r.substring(2),e.xcssHandler)})}function T(){}function O(e,t,n){for(;0===e.indexOf("@");)e=t.getAttribute(e.substring(1));fetch(e).then(function(o){o.text().then(function(o){console.log(e),console.log(o),e.indexOf("://")>0&&B.test(o)||_.test(o)?console.error("unsafe content ignored!"):j(t,o,n)})})}function j(e,t,c){function i(t,c){var i=e.tagName.toLowerCase();"input"===i||"textarea"===i?(Array.isArray(e.orgValue)||(e.orgValue=[e.value]),e.value=t):(Array.isArray(e.orgValue)||(e.orgValue=[e.innerHTML]),t!==e.dataHtml&&(e.innerHTML=t,e.dataHtml=t,n(e,c||0),o(e),r(e)))}"string"==typeof t?i(t,c):t&&t.then&&t.then(function(e){i(e,c)})}function L(t,n,o,r){function c(n){var c,a,u,f,p,h,d,g=/var\(--([^\)]*)\)/;console.log("event received: "+t,"evt:",n);var v=n.path,m=n.params,y=s;Object.keys(m).forEach(function(e){y=y.replace("${"+e+"}",m[e])});var x=r[o].style.content,E=i.filter(function(e){return e.pattern.test(v)})[0];console.log(P);var b=i.filter(function(e){return e.pattern.test(P.path||"")})[0];console.log(b);for(var w=document.querySelectorAll(y),T=0;T<w.length;T++){var L=w[T];if(console.log("event handled by ",y+"["+T+"]"),void 0===L.cssText&&(L.cssText=L.style.cssText||""),E){if(a=E.params,a.forEach(function(t){var n=t.split("=");if(1===n.length&&x)return h=new RegExp("\\$\\{"+t+"\\}","g"),d=(m||{})[t]||"",void(x=x.replace(h,d));if(f=n.shift(),p=n.join("=").replace(/^"/,"").replace(/"$/,""),p=p.replace(/^\\'/,"'").replace(/\\'$/,"'")){p=p.replace(/\$\{[^\}]*\}/g,function(e){return m[e.substring(2,e.length-1)]}),p=p.replace(/\\'/g,"'");try{m[f]=e(p)||""}catch(o){console.error("could not evaluate",p)}}}),l=r[o].style.cssText.split("; ").filter(function(e){return e.trim().indexOf("content:")<0}).join(";\n"),L.style.cssText=l.replace(/\$\{[^\}]*\}/g,function(e){return m[e.substring(2,e.length-1)]}),[].slice.call(r[o].style,0).forEach(function(e){function t(e,t){var t=n.replace(g,t);L.style[e]=t}var n=r[o].style[e],c=n.match(g);if(c&&c[1]){var i=c[1].split(","),l=i.shift(),s=m[l]||i[0];if(s){var a=e.replace(/(-\w)/,function(e){return e.substring(1).toUpperCase()});"function"==typeof s.then?s.then(function(e){t(a,e||i[0])}):t(a,s)}}}),x)if(console.log(b),c=x.match(/^url\("([^)]*)"\)$/))u=$(c[1],m),O(u,L);else if(c=x.match(/^url\(([^)]*)\)$/))u=$(c[1],m),O(u,L);else if(c=x.match(/^"([^"]*)"$/)){var S=$(c[1],m);j(L,S)}}else if(w[T].style.cssText=w[T].cssText,x&&Array.isArray(L.orgValue)){var C=["input","textarea"].indexOf(L.tagName)<0?"innerHTML":"value";L[C]=L.orgValue[0],L.dataHtml=L.orgValue[0]}}}console.log("makeStateChangeListener for: "+t+", sources: "+n);var i=n.map(function(e){var t=e.split(/[\[\]]/),n=t.shift().trim(),o=n.replace(/\s*\*\s*/g,".*").replace(/>/g,"/");return{path:n,pattern:new RegExp("^"+o+"$"),params:t.filter(function(e){return!!e.trim()})}}),l="",s=t+"";return c}function $(t,n){var o=t.replace(/\$\{[^\}]*\}/g,function(e){return n[e.substring(2,e.length-1)]});try{return e(o)}catch(r){console.error(r)}}function S(t){return function(n){var o,r,c,i,l=t.split("[")[0],s="",a="?",u=n.currentTarget||n.srcElement,f=t.match(/\[[^\]]+]/g)||[];f.forEach(function(t){if(t=t.replace(/^\[/,"").replace(/\]$/,""),i=t.split('="'),r=i[0],c=i[1]){c=c.replace(/\${[^\}]*}/g,function(e){var t=e.replace(/^\${/,"").replace(/}$/,"");return u[t]||u.getAttribute(t)}),[].slice.call(u.attributes,0).forEach(function(e){c=c.replace("@{"+e.name+"}",e.value)});try{c=e(c.replace(/^"/,"").replace(/"$/,""))}catch(n){c=c.replace(/^"/,"").replace(/"$/,""),console.log("eval to literal value as string")}}else c=u[r]||u.getAttribute(r);s+=a+r+"="+encodeURIComponent(c),a="&"});var p=location.hash.replace(/^#/,"").split("/").map(function(e){return e.split("?")[0]}),h=l.replace(/^[#>+~\.\/-]/,"").trim(),d=p.indexOf(h),g=location.hash.replace(/^#/,"").split("/");0===l.indexOf("+")?(d>=0&&g.pop(),g.push(h),location.hash=g.join("/")+s):0===l.indexOf("-")?("*"===h&&(d=g.length-1),p[p.length-1]===h&&(location.hash=g.slice(0,g.length-2).join("/"))):0===l.indexOf("~")?("*"===h&&(d=g.length-1),d>=0&&(location.hash=g.filter(function(e,t){return t!==d}).join("/"))):0===l.indexOf(">")?(o=g.pop(),l.indexOf(".")<0?g.push(h):o!==h&&(g.push(o),g.push(h)),location.hash=g.join("/")+s):0===l.indexOf(".")?(g.push(h),location.hash=g.join("/")+s):0===l.indexOf(":empty")||(location.hash=l+s),console.log("new Hash: "+location.hash)}}function C(e,t){[].slice.call(e.styleSheets||[]).forEach(function(e){0===(e.href||"").indexOf(window.location.origin)&&[].slice.call(e.cssRules||[]).forEach(function(e){R[e.selectorText]=e}),C(e,!0)}),t||console.debug("collected nr of rules: "+Object.keys(R).length)}function H(){var e=document.createElement("style");return document.head.appendChild(e),e.sheet}var A=100,R={},k={},M={},N={},I={},q={},U={},W={},V=[],F=[],P={},D={EXTENDS:x,APPLIES:E,COMPONENT:y,WHEN:b,PULL:f,SIZE:h,AND:T,OR:T,TIMER:g};for(var z in HTMLElement.prototype)0===z.indexOf("on")&&F.push(z.toUpperCase());var Z=Object.keys(D).concat(F).join("|"),X=new RegExp("\\s+("+Z+"),?\\s+","i"),_=new RegExp("\\W+("+F.join("|")+")\\W*=\\W*['\"]","i"),B=/<script[>\W]/i,G=H(),J={};document.addEventListener("DOMContentLoaded",c),window.addEventListener("hashchange",t),window.addEventListener("resize",p),window.addEventListener("resize",d)}(function _evaluate(expr,elm,env){return eval(expr)});
//# sourceMappingURL=./dist/xcss.map