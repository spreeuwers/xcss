!function(e){"use strict";function t(){var e=location.hash.replace(/^#\/?/,"").split("/").map(function(e){var t=e.split("?"),n=(t[1]||"").split("&"),o=t[0],r={};return r[o]={},n.forEach(function(e){var t=e.split("="),n=t[0],c=decodeURIComponent(t[1]);r[o][n]=c}),r});e.path=e.map(function(e){return Object.keys(e)[0]}).join("/"),e.params={},e.forEach(function(t){var n=t[Object.keys(t)[0]];Object.keys(n).forEach(function(t){e.params[t]=n[t]})}),console.log("state:",e),z.forEach(function(t){t(e)}),window.setTimeout(function(){h()},100),X=e}function n(e,t){return t&&t>M?void console.log("Max nesting level is: "+M):(t++,void Object.keys(P).forEach(function(n){a(P,n,null,null,null,e,t)}))}function o(e){Object.keys(N).forEach(function(t){for(var n=e||document,o=n.querySelectorAll(t),r=0;r<o.length;r++){var c=N[t];o[r].xcssHandler||(console.log("binding message events: "+c.hash+" to "+t),"prevent"===c.hash?o[r].xcssHandler=function(e){e.preventDefault(),e.stopPropagation()}:o[r].xcssHandler=C(c.hash),o[r].addEventListener(c.event,o[r].xcssHandler))}})}function r(e){Object.keys(U).forEach(function(t){var n=e||document,o=n.querySelectorAll(t)||[],r=U[t]||[];[].slice.call(o).forEach(function(e){r.forEach(function(n){console.log("applying "+n+" to "+t),e.classList.add(n)})})})}function c(t){function n(e,t){var n=document.querySelectorAll('[data-model="'+t+'"]');e instanceof Object&&[].slice.call(n).forEach(function(t){var n=t.getAttribute("name")||"";t.constructor.prototype.hasOwnProperty("value")?t.value=e[n]:t.innerHTML=e[n]})}Object.keys(F).forEach(function(o){var r=t||document,c=r.querySelectorAll(o)||[],i=F[o]||[],l=(i[0]||"").split("["),s=l.shift().trim();[].slice.call(c).forEach(function(t){if(t.getAttribute("data-model")!==s){var o=e(s,t);t.setAttribute("data-model",s),n(o,s),t.addEventListener("input",function(){o[t.name||""]=t.value,n(o,s)}),console.log("bound model ",s," to ",t.name)}})})}function i(){window.setTimeout(l,10)}function l(){console.time("processCSSRules"),A(document).then(function(){s(I),console.timeEnd("processCSSRules"),t()})}function s(e){Object.keys(e).forEach(function(t){var n,o,r,c="",i="",l=[],s={},u=t.split('"').map(function(e,t){return t%2===1?(s["$"+t]=e,"$"+t):e}).join('"'),f=u.split(J);if(!q[t])if(q[t]=e[t],console.log("parts: ["+f.join(" : "),"] selector:",t),n="",f.length>2){if(i=f.shift().trim().replace(/"\$(\d+)"/g,'"'+s.$1+'"'),c=f.shift().trim(),o=c.toUpperCase(),r=c.toLowerCase(),l=f.filter(function(e){var t=_[e.toUpperCase()];return n=t&&T!==t?c:n,!t}).map(function(e){return e.replace(/"\$\d+"/g,function(e){return'"'+s[e.replace(/"/g,"")]+'"'})}),n)return void console.error('cannot proces invalid xcss rule: "'+t+'" unexpected keyword "'+n+'"');_[o]?_[o](e,t,i,l,c):Z.indexOf(o)>=0&&(O(e,t,i,l,r),x(e,t,i,[t],c))}else e[t].style&&e[t].style.content&&a(e,t,i,l,c)})}function a(t,n,o,r,c,i,l){var s,a,u=t[n].style.content||"",f=document.querySelectorAll(o||n);i&&(f=i.querySelectorAll(o||n)),/:(before|after)/.test(n)||(P[n]||(P[n]={style:{content:I[n].style.content}}),console.trace("inserting content for: "+n),(a=u.match(/^"?url\(([^)]*)\)"?$/))&&(s=a[1],(a=s.match(/^"(.*)"$/))&&(s=s.slice(1,-1)),(a=u.match(/^"(.*)"$/))&&(u=u.slice(1,-1))),I[n].style.content="",[].slice.call(f).forEach(function(t){if(t.insertedContent!==u)if(t.insertedContent=u,s)/^@/.test(s)&&(s="'"+s+"'"),L(e(s,t),t,l);else try{var n=e(u.slice(1,-1),t);j(t,n,l)}catch(o){console.error("Could not evaluate expression: "+u)}}))}function u(e,t){var n=document.querySelectorAll(e);[].slice.call(n).forEach(function(e){e.style.boxSizing="border-box";var t=parseInt(e.style.marginLeft||"0"),n=e.parentNode.offsetWidth+e.parentNode.offsetLeft-(e.offsetLeft+e.offsetWidth);e.style.marginLeft=t+n+"px",e.style.marginRight="0px",e.style.marginTop="-70px"})}function f(t,n){console.log("sizeElements"),n&&n.forEach(function(n){var o=n.style,r=o.cssText.split("; ").filter(function(e){return e.trim().indexOf("content:")<0}).join(";\n"),c=o.content,i=document.querySelectorAll(t);[].slice.call(i).forEach(function(t){var o=n.selectorText.toUpperCase().indexOf(" SIZE "),i=n.selectorText.substring(o+6),l=!1,s=i.match(/(widthFor|heightFor)\[([^=]*)="(.*)"\]/);if(s){var a=s[3],u=document.createElement("div");u.style.cssText="position='absolute';width:auto;height:auto;white-space: nowrap;display:inline-block",u.innerHTML=a,t.appendChild(u),t.width=t.offsetWidth,t.height=t.offsetHeight,t.widthFor={},t.heightFor={},t.widthFor[a]=u.offsetWidth,t.heightFor[a]=u.offsetHeight,t.removeChild(u)}try{l=e(i,t)}catch(f){console.error("invalid SIZE condition! "+i+", error: "+f)}if(l&&(console.log("SIZE condition: "+i),t.style.cssText=r.replace(/\$\{[^\}]*\}/g,function(n){var o=n.substring(2,n.length-1);return e(o,t)}),c)){var p=""+e(c.slice(1,-1),t);j(t,p)}})})}function p(e,t,n,o,r){W[n]=o,u(n,o[0]),h()}function h(){Object.keys(W).forEach(function(e){window.setTimeout(function(){u(e,W[e])},100)})}function d(e,t,n,o,r){V[n]||(V[n]=[]),V[n].push(e[t]),g()}function g(){Object.keys(V).forEach(function(e){window.setTimeout(function(){f(e,V[e])},100)})}function m(e,t,n,o,r){V[n]||(V[n]=[]),D[n].push(e[t]),v(o)}function v(){Object.keys(D).forEach(function(e){window.setTimeout(function(){y(e,V[e])},parsetInt(sources[0]))})}function y(e,t){console.log("timer event for : "+e)}function E(e,t,n,o,r){var c,i=Object.create(HTMLElement.prototype),l={},s=/\[template(Id|Url)="([\w-\/\.]*)"\]/i,a=o[0].match(s);a?(l.template={},a.shift(),c=a.shift().toLowerCase(),l.template[c]=a.shift()):l.content=e[t].style.content.replace(/^"/,"").replace(/"$/,""),ee[n.toUpperCase()]=l,i.createdCallback=function(){var e=this.createShadowRoot(),t=ee[this.tagName];if(t.template)if(t.template.id){var n=document.querySelector("#"+t.template.id),o=document.importNode(n.content,!0);e.appendChild(o)}else t.template.url&&fetch(t.template.url).then(function(e){return e.text()}).then(function(t){e.innerHTML=t});else e.innerHTML=t.content},document.registerElement&&document.registerElement(n,{prototype:i});var u=e[t];Y.insertRule(n+"{"+u.style.cssText+"}",Y.cssRules.length)}function x(e,t,n,o,r){var c=o.map(function(t){return e[t]||(console.log("resolving rule fromSelector: "+t),s(e)),e[t]?console.debug("Resolved rule fromSelector: "+t+" = "+e[t].style.cssText):console.error("Could not resolve rule fromSelector: "+t),e[t]?e[t].style.cssText:""}).join(" "),i=e[t];console.log("adding rule: "+n+"{"+c+i.style.cssText+"}");var l=Y.insertRule(n+"{"+c+i.style.cssText+"}",Y.cssRules.length);if(e[n]=Y.cssRules[l],e[n].style.content){var u=0;a(e,n,n,o,r,document,u)}}function b(e,t,n,o,r){var c=document.querySelectorAll(n);U[n]=o,[].slice.call(c).forEach(function(e){o.forEach(function(t){var o;if(o=t.match(/^\[(.*)\]$/)){var r=o[1].split("=");console.log("applying attr: "+o[1]+" to "+n),e.setAttribute(r[0],r[1]||r[0])}else console.log("applying class: "+t+" to "+n),e.classList.add(t)})})}function w(e,t,n,o,r){console.log("binding message WHEN listener: "+o+" to "+t),console.log("binding message listener: "+o),z.push(S(n,o,t,e))}function O(e,t,n,o,r){var c=o[0]||r;console.log("binding message events: "+c+" to "+n+" for "+r),N[n]={hash:c,event:r.substring(2)};var i=document.querySelectorAll(n);[].slice.call(i).forEach(function(e){"prevent"===c?e.xcssHandler=function(e){e.preventDefault(),e.stopPropagation()}:e.xcssHandler=C(c),e.addEventListener(r.substring(2),e.xcssHandler)})}function T(){}function L(e,t,n){for(;0===e.indexOf("@");)e=t.getAttribute(e.substring(1));e=encodeURI(e),fetch(e).then(function(o){o.text().then(function(o){e.indexOf("://")>0&&Q.test(o)||K.test(o)?console.error("unsafe content ignored!"):j(t,o,n)})})}function j(e,t,i){function l(t,i){var l=e.tagName.toLowerCase();e.constructor.prototype.hasOwnProperty("value")&&"select"!==l?(Array.isArray(e.orgValue)||(e.orgValue=[e.value]),e.value=t):(Array.isArray(e.orgValue)||(e.orgValue=[e.innerHTML]),t!==e.dataHtml&&(e.dataHtml=t,e.innerHTML.indexOf("<!--slot-->")>=0&&(t=e.innerHTML.replace("<!--slot-->",t)),e.innerHTML=t,n(e,i||0),o(e),r(e),c(e)))}"string"==typeof t?l(t,i):t&&t.then&&t.then(function(e){l(e,i)})}function S(t,n,o,r){function c(n){var c,a,u,f,p,h,d,g=/var\(--([^\)]*)\)/;console.log("event received: "+t,"evt:",n);var m=n.path,v=n.params,y=s;Object.keys(v).forEach(function(e){y=y.replace("${"+e+"}",v[e])});var E=r[o].style.content,x=i.filter(function(e){return e.pattern.test(m)})[0];console.log(X);var b=i.filter(function(e){return e.pattern.test(X.path||"")})[0];console.log(b);for(var w=document.querySelectorAll(y),O=0;O<w.length;O++){var T=w[O];if(console.log("event handled by ",y+"["+O+"]"),void 0===T.cssText&&(T.cssText=T.style.cssText||""),x){if(a=x.params,a.forEach(function(t){var n=t.split("=");if(1===n.length&&E)return h=new RegExp("\\$\\{"+t+"\\}","g"),d=(v||{})[t]||"",void(E=E.replace(h,d));if(f=n.shift(),p=n.join("=").replace(/^"/,"").replace(/"$/,""),p=p.replace(/^\\'/,"'").replace(/\\'$/,"'")){p=p.replace(/\$\{[^\}]*\}/g,function(e){return v[e.substring(2,e.length-1)]}),p=p.replace(/\\'/g,"'");try{v[f]=e(p,T)||"",/^--/.test(f)&&T.style.setProperty(f,v[f])}catch(o){console.error("could not evaluate",p)}}}),l=r[o].style.cssText.split("; ").filter(function(e){return e.trim().indexOf("content:")<0}).join(";\n"),T.style.cssText=l.replace(/\$\{[^\}]*\}/g,function(e){return v[e.substring(2,e.length-1)]}),[].slice.call(r[o].style,0).forEach(function(e){function t(e,t){var t=n.replace(g,t);T.style[e]=t}var n=r[o].style[e],c=n.match(g);if(c&&c[1]){var i=c[1].split(","),l=i.shift(),s=v[l]||i[0];if(s){var a=e.replace(/(-\w)/,function(e){return e.substring(1).toUpperCase()});"function"==typeof s.then?s.then(function(e){t(a,e||i[0])}):t(a,s)}}}),E)if(console.log(b),c=E.match(/^url\("([^)]*)"\)$/))u=$(c[1],v,T),L(u,T);else if(c=E.match(/^url\(([^)]*)\)$/))u=$(c[1],v,T),L(u,T);else if(c=E.match(/^"([^"]*)"$/)){var S=$(c[1],v,T);j(T,S)}}else if(w[O].style.cssText=w[O].cssText,E&&Array.isArray(T.orgValue)){var C=["input","textarea"].indexOf(T.tagName)<0?"innerHTML":"value";T[C]=T.orgValue[0],T.dataHtml=T.orgValue[0]}}}console.log("makeStateChangeListener for: "+t+", sources: "+n);var i=n.map(function(e){var t=e.split(/[\[\]]/),n=t.shift().trim(),o=n.replace(/\s*\*\s*/g,".*").replace(/>/g,"/");return{path:n,pattern:new RegExp("^"+o+"$"),params:t.filter(function(e){return!!e.trim()})}}),l="",s=t+"";return c}function $(t,n,o){var r=t.replace(/\$\{[^\}]*\}/g,function(e){return n[e.substring(2,e.length-1)]});try{return e(r,o)}catch(c){console.error(c)}}function C(t){return function(n){var o,r,c,i,l=t.split("[")[0],s="",a="?",u=n.currentTarget||n.srcElement,f=t.match(/\[[^\]]+]/g)||[];f.forEach(function(t){if(t=t.replace(/^\[/,"").replace(/\]$/,""),i=t.split('="'),r=i[0],c=i[1]){c=c.replace(/\${[^\}]*}/g,function(e){var t=e.replace(/^\${/,"").replace(/}$/,"");return u[t]||u.getAttribute(t)}),[].slice.call(u.attributes,0).forEach(function(e){c=c.replace("@{"+e.name+"}",e.value)});try{c=e(c.replace(/^"/,"").replace(/"$/,""),u)}catch(n){c=c.replace(/^"/,"").replace(/"$/,""),console.log("eval to literal value as string")}}else c=u[r]||u.getAttribute(r);s+=a+r+"="+encodeURIComponent(c),a="&"});var p=location.hash.replace(/^#/,"").split("/").map(function(e){return e.split("?")[0]}),h=l.replace(/^[#>+~\.\/-]/,"").trim(),d=p.indexOf(h),g=location.hash.replace(/^#/,"").split("/");0===l.indexOf("+")?(d>=0&&g.pop(),g.push(h),location.hash=g.join("/")+s):0===l.indexOf("-")?("*"===h&&(d=g.length-1),p[p.length-1]===h&&(location.hash=g.slice(0,g.length-2).join("/"))):0===l.indexOf("~")?("*"===h&&(d=g.length-1),d>=0&&(location.hash=g.filter(function(e,t){return t!==d}).join("/"))):0===l.indexOf(">")?(o=g.pop(),l.indexOf(".")<0?g.push(h):o!==h&&(g.push(o),g.push(h)),location.hash=g.join("/")+s):0===l.indexOf(".")?(g.push(h),location.hash=g.join("/")+s):0===l.indexOf(":empty")||(location.hash=l+s),console.log("new Hash: "+location.hash)}}function A(e,t,n,o){return t?void[].slice.call(e.styleSheets||[]).forEach(function(e){0===(e.href||window.location.origin).indexOf(window.location.origin)&&H(e,o),A(e,t,n,o)}):new Promise(function(t,n){var o={};A(e,t,n,o);var r=0;window.setTimeout(function c(){var n=Object.keys(o).every(function(e){return o[e]});n?(console.debug("collected nr of rules: "+Object.keys(I).length),t()):(r++,r<10?window.setTimeout(c,10):console.error("not load rules from :"+e.href+"!, could be a CORS problem"))},10)})}function H(e,t,n){var o=(n||0)+1;if(e.cssRules)[].slice.call(e.cssRules||[]).forEach(function(e){I[e.selectorText]=e}),t[e.href]=!0;else{if(t[e.href]=!1,o>10)return void console.log("no rules");window.setTimeout(function(){H(e,t,o)},100)}}function R(e,t,n,o,r){console.log("model",t,n,o,r),F[n]=o,c(document)}function k(){var e=document.createElement("style");return document.head.appendChild(e),e.sheet}var M=100,I={},q={},N={},U={},P={},W={},V={},D={},F={},z=[],Z=[],X={},_={EXTENDS:x,APPLIES:b,COMPONENT:E,WHEN:w,PULL:p,SIZE:d,AND:T,OR:T,TIMER:m,MODEL:R};for(var B in HTMLElement.prototype)0===B.indexOf("on")&&Z.push(B.toUpperCase());var G=Object.keys(_).concat(Z).join("|"),J=new RegExp("\\s+("+G+"),?\\s+","i"),K=new RegExp("\\W+("+Z.join("|")+")\\W*=\\W*['\"]","i"),Q=/<script[>\W]/i,Y=k(),ee={};document.addEventListener("DOMContentLoaded",i),window.addEventListener("hashchange",t),window.addEventListener("resize",h),window.addEventListener("resize",g)}(function _evaluate(expr,elm,self){return eval(decodeURIComponent(expr))});
//# sourceMappingURL=./dist/xcss.map